<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Оформлення замовлення — Modna Я</title>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;800&display=swap" rel="stylesheet">
<link rel="stylesheet" href="styles.css">

<style>
  body{opacity:0;transition:opacity .6s ease}
  body.ready{opacity:1}

  .order-box{
    background:#fff;
    padding:22px;
    border-radius:16px;
    box-shadow:var(--shadow);
    max-width:560px;
    margin:34px auto;
  }
  h1{text-align:center;margin-bottom:18px}
  label{font-weight:600;margin:12px 0 4px;display:block}
  input{
    width:100%;padding:12px;border-radius:12px;
    border:1px solid #ddd;margin-bottom:12px;font-size:16px;
  }
  .summary{
    background:var(--beige);padding:14px;border-radius:12px;margin-bottom:14px;
  }
  .summary-row{display:flex;align-items:center;gap:14px}
  .summary img{
    width:80px;height:110px;border-radius:10px;object-fit:cover;
  }
  .price-box{
    background:#fff7f8;border-radius:12px;padding:12px;
    margin:12px 0;border:1px solid #eee;
  }
  .price-line{
    display:flex;justify-content:space-between;font-size:16px;margin:4px 0;
  }
  .total{
    font-size:18px;font-weight:800;color:var(--brand);
  }

  /* Оплати */
  .pay-box{
    background:#fff7f8;border-radius:12px;padding:10px;
    margin-bottom:14px;border:1px solid #eee;
  }
  .pay-option{
    display:flex;align-items:center;gap:10px;margin:6px 0;cursor:pointer;
  }
  .pay-option input{transform:scale(1.2)}
  .pay-icons{display:flex;gap:10px;margin-top:6px}
  .pay-icons img{height:28px}

  .btn-submit{
    background:var(--brand);
    color:#fff;width:100%;padding:16px;border-radius:14px;
    font-weight:700;font-size:18px;border:0;cursor:pointer;
  }
  .btn-submit:hover{filter:brightness(.95)}
</style>

<script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
<script>
(function(){
  emailjs.init("6FwzARyu-NBxxfoi5"); // ✅ Твій Public Key
})();
</script>
</head>


<body>
<header class="header">
  <div class="container row">
    <a class="logo" href="index.html">Modna Я</a>
    <nav class="nav">
      <a href="catalog.html">Каталог</a>
      <a href="cart.html">Кошик</a>
      <a class="cta" href="order.html">Оформлення</a>
    </nav>
  </div>
</header>


<main class="container">
  <form class="order-box" id="order-form">
    <h1>Оформлення замовлення</h1>

    <!-- Товар -->
    <div id="productSummary"></div>

    <!-- Клієнт -->
    <label>Ваше ім’я:</label>
    <input type="text" name="user_name" required>

    <label>Телефон:</label>
    <input type="tel" name="user_phone" required placeholder="+380…" pattern="\\+?3?8?(0\\d{9})">

    <label>Місто:</label>
    <input type="text" name="user_city" required>

    <label>Відділення Нової Пошти:</label>
    <input type="text" name="user_np" required>


    <!-- Оплата -->
    <label>Спосіб оплати:</label>
    <div class="pay-box">
      <label class="pay-option">
        <input type="radio" name="payment" value="online" checked>
        Онлайн оплата (Google/Apple Pay)
      </label>
      <label class="pay-option">
        <input type="radio" name="payment" value="cod">
        Накладений платіж (+150 грн передплата)
      </label>

      <div class="pay-icons">
        <img src="https://upload.wikimedia.org/wikipedia/commons/5/5e/Google_Pay_Logo.svg">
        <img src="https://upload.wikimedia.org/wikipedia/commons/f/fa/Apple_logo_black.svg">
      </div>
    </div>


    <!-- Підсумок суми -->
    <div class="price-box">
      <div class="price-line">
        <span>Товар:</span><span id="price-product">0 ₴</span>
      </div>
      <div class="price-line">
        <span>Передплата:</span><span id="price-prepay">0 ₴</span>
      </div>
      <div class="price-line total">
        <span>Разом:</span><span id="price-total">0 ₴</span>
      </div>
    </div>


    <!-- hidden for EmailJS -->
    <input type="hidden" name="product_name" id="hidden_product_name">
    <input type="hidden" name="product_size" id="hidden_product_size">
    <input type="hidden" name="product_price" id="hidden_product_price">
    <input type="hidden" name="payment_method" id="hidden_payment">
    <input type="hidden" name="order_id" id="hidden_order_id">

    <button class="btn-submit" type="submit">Підтвердити замовлення ✅</button>
  </form>
</main>


<footer class="footer">
  <div class="container row">
    <small>© 2025 <b>Modna Я</b>. Усі права захищені.</small>
  </div>
</footer>


<script>
window.addEventListener('load',()=>document.body.classList.add('ready'));

const orderProduct = JSON.parse(localStorage.getItem("orderProduct"));
if(orderProduct){
  document.getElementById("productSummary").innerHTML = `
    <div class="summary">
      <div class="summary-row">
        <img src="${orderProduct.img}">
        <div>
          <b>${orderProduct.title}</b><br>
          Розмір: ${orderProduct.selectedSize}<br>
          <b>${orderProduct.price.toLocaleString('uk-UA')} ₴</b>
        </div>
      </div>
    </div>`;
  document.getElementById("hidden_product_name").value = orderProduct.title;
  document.getElementById("hidden_product_size").value = orderProduct.selectedSize;
  document.getElementById("hidden_product_price").value = orderProduct.price;
}


// 💸 Розрахунок суми
function updatePrices(){
  const price = orderProduct ? orderProduct.price : 0;
  const pay = document.querySelector('input[name="payment"]:checked').value;

  let prepay = 0;
  if(pay === "cod") prepay = 150;

  const total = price + prepay;

  document.getElementById("price-product").textContent = price.toLocaleString('uk-UA') + " ₴";
  document.getElementById("price-prepay").textContent = prepay.toLocaleString('uk-UA') + " ₴";
  document.getElementById("price-total").textContent = total.toLocaleString('uk-UA') + " ₴";
}
updatePrices();
document.querySelectorAll('input[name="payment"]').forEach(el=>el.onchange=updatePrices);


// ✅ Відправка замовлення
document.getElementById("order-form").addEventListener("submit", function(e){
  e.preventDefault();

  const orderId = "MOD-" + Date.now();
  localStorage.setItem("orderNumber", orderId);
  document.getElementById("hidden_order_id").value = orderId;

  const pay = document.querySelector('input[name="payment"]:checked').value;
  document.getElementById("hidden_payment").value =
    pay === "online" ? "Онлайн оплата (GPay/ApplePay)" :
    "Накладений платіж (передплата 150 грн)";

  document.body.style.opacity = "0";

  emailjs.sendForm("service_ax18fmw", "template_pjji5h5", this)
  .then(()=> setTimeout(()=>location.href="success.html",600))
  .catch(()=> setTimeout(()=>location.href="error.html",600));
});
</script>

</body>
</html>

